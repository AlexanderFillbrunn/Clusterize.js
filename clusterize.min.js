/*! Clusterize.js - v0.16.0 - 2016-03-12
* http://NeXTs.github.com/Clusterize.js/
* Copyright (c) 2015 Denis Lukov; Licensed GPLv3 */

!function(t,e){"undefined"!=typeof module?module.exports=e():"function"==typeof define&&"object"==typeof define.amd?define(e):this[t]=e()}("Clusterize",function(){"use strict";function t(t,e,o){return e.addEventListener?e.addEventListener(t,o,!1):e.attachEvent("on"+t,o)}function e(t,e,o){return e.removeEventListener?e.removeEventListener(t,o,!1):e.detachEvent("on"+t,o)}function o(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t,e){return window.getComputedStyle?window.getComputedStyle(e)[t]:e.currentStyle[t]}var r=function(){for(var t=3,e=document.createElement("b"),o=e.all||[];e.innerHTML="<!--[if gt IE "+ ++t+"]><i><![endif]-->",o[0];);return t>4?t:document.documentMode}(),i=navigator.platform.toLowerCase().indexOf("mac")+1,s=function(n){function r(t,e){return"function"==typeof t?{get:t,length:function(){return e},type:"fn"}:{get:function(e){return t[e]},length:function(){return t.length},data:function(){return t},type:"array"}}if(!(this instanceof s))return new s(n);var l=this,a={item_height:0,block_height:0,rows_in_block:50,rows_in_cluster:0,cluster_height:0,blocks_in_cluster:4,tag:null,content_tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{},scroll_top:0};l.options={};for(var c,h=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],u=0;c=h[u];u++)l.options[c]="undefined"!=typeof n[c]&&null!=n[c]?n[c]:a[c];for(var _,f=["scroll","content"],u=0;_=f[u];u++)if(l[_+"_elem"]=n[_+"Id"]?document.getElementById(n[_+"Id"]):n[_+"Elem"],!l[_+"_elem"])throw new Error("Error! Could not find "+_+" element");l.content_elem.hasAttribute("tabindex")||l.content_elem.setAttribute("tabindex",0);var p;p=o(n.rows)?r(n.rows):"function"==typeof n.rows?r(n.rows,n.size):r(l.fetchMarkup());var g={data:"",bottom:0},d=l.scroll_elem.scrollTop;l.exploreEnvironment(p),l.insertToDOM(p,g),l.scroll_elem.scrollTop=d;var m=!1,w=0,v=!1,b=function(){i&&(v||(l.content_elem.style.pointerEvents="none"),v=!0,clearTimeout(w),w=setTimeout(function(){l.content_elem.style.pointerEvents="auto",v=!1},50)),m!=(m=l.getClusterNum())&&l.insertToDOM(p,g),l.options.callbacks.scrollingProgress&&l.options.callbacks.scrollingProgress(l.getScrollProgress())},y=0,C=function(){clearTimeout(y),y=setTimeout(l.refresh,100)};t("scroll",l.scroll_elem,b),t("resize",window,C),l.destroy=function(t){e("scroll",l.scroll_elem,b),e("resize",window,C),l.html((t?l.generateEmptyRow():p).join(""))},l.refresh=function(){l.getRowsHeight(p)&&l.update(p)},l.update=function(t){p=r(o(t)?t:[]);var e=l.scroll_elem.scrollTop;p.length()*l.options.item_height<e&&(l.scroll_elem.scrollTop=0,m=0),l.insertToDOM(p,g),l.scroll_elem.scrollTop=e},l.clear=function(){l.update([])},l.getRowsAmount=function(){return p.length()},l.getScrollProgress=function(){return this.options.scroll_top/(p.length()*this.options.item_height)*100||0};var E=function(t,e){if("fn"==p.type)throw new Error("Error: Cannot add elements when source is a function");var n=o(e)?e:[];n.length&&(p=r("append"==t?p.data().concat(n):n.concat(p)),l.insertToDOM(p,g))};l.append=function(t){E("append",t)},l.prepend=function(t){E("prepend",t)}};return s.prototype={constructor:s,fetchMarkup:function(){for(var t=[],e=this.getChildNodes(this.content_elem);e.length;)t.push(e.shift().outerHTML);return t},exploreEnvironment:function(t){var e=this.options;if(e.content_tag=this.content_elem.tagName.toLowerCase(),t.length()){var o=t.get(0);r&&9>=r&&!e.tag&&(e.tag=o.match(/<([^>\s\/]*)/)[1].toLowerCase()),this.content_elem.children.length<=1&&this.html(o+o+o),e.tag||(e.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(t)}},getRowsHeight:function(t){var e=this.options,o=e.item_height;if(e.cluster_height=0,t.length()){var r=this.content_elem.children;return e.item_height=r[Math.floor(r.length/2)].offsetHeight,"tr"==e.tag&&"collapse"!=n("borderCollapse",this.content_elem)&&(e.item_height+=parseInt(n("borderSpacing",this.content_elem))||0),e.block_height=e.item_height*e.rows_in_block,e.rows_in_cluster=e.blocks_in_cluster*e.rows_in_block,e.cluster_height=e.blocks_in_cluster*e.block_height,o!=e.item_height}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var t=this.options;if(!t.tag||!t.show_no_data_row)return[];var e,o=document.createElement(t.tag),n=document.createTextNode(t.no_data_text);return o.className=t.no_data_class,"tr"==t.tag&&(e=document.createElement("td"),e.appendChild(n)),o.appendChild(e||n),[o.outerHTML]},generate:function(t,e){var o=this.options,n=t.length();if(n<o.rows_in_block){var r;if(n)if("fn"===t.type){r=[];for(var i=0;i<t.length();i++)r.push(t.get(i))}else r=t.data;else r=this.generateEmptyRow();return{top_offset:0,bottom_offset:0,rows_above:0,rows:r}}o.cluster_height||this.exploreEnvironment(t);var s=Math.max((o.rows_in_cluster-o.rows_in_block)*e,0),l=s+o.rows_in_cluster,a=Math.max(s*o.item_height,0),c=Math.max((n-l)*o.item_height,0),h=[],u=s;1>a&&u++;for(var i=s;l>i;i++)t.get(i)&&h.push(t.get(i));return{top_offset:a,bottom_offset:c,rows_above:u,rows:h}},renderExtraTag:function(t,e){var o=document.createElement(this.options.tag),n="clusterize-";return o.className=[n+"extra-row",n+t].join(" "),e&&(o.style.height=e+"px"),o.outerHTML},insertToDOM:function(t,e){var o=this.generate(t,this.getClusterNum()),n=o.rows.join(""),r=this.checkChanges("data",n,e),i=this.checkChanges("bottom",o.bottom_offset,e),s=this.options.callbacks,l=[];r?(o.top_offset&&(this.options.keep_parity&&l.push(this.renderExtraTag("keep-parity")),l.push(this.renderExtraTag("top-space",o.top_offset))),l.push(n),o.bottom_offset&&l.push(this.renderExtraTag("bottom-space",o.bottom_offset)),s.clusterWillChange&&s.clusterWillChange(),this.html(l.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",o.rows_above),s.clusterChanged&&s.clusterChanged()):i&&(this.content_elem.lastChild.style.height=o.bottom_offset+"px")},html:function(t){var e=this.content_elem;if(r&&9>=r&&"tr"==this.options.tag){var o,n=document.createElement("div");for(n.innerHTML="<table><tbody>"+t+"</tbody></table>";o=e.lastChild;)e.removeChild(o);for(var i=this.getChildNodes(n.firstChild.firstChild);i.length;)e.appendChild(i.shift())}else e.innerHTML=t},getChildNodes:function(t){for(var e=t.children,o=[],n=0,r=e.length;r>n;n++)o.push(e[n]);return o},checkChanges:function(t,e,o){var n=e!=o[t];return o[t]=e,n}},s});
